<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Sunday, July 04, 2021, 9:31 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "PutKept" generated by Plugin Wizard -->

<muclient>
<plugin
   name="PutKept"
   author="Naricain"
   id="1d779bcb8ebffc9319bb2199"
   language="Lua"
   purpose="Put all kept items in the target container"
   save_state="y"
   date_written="2021-07-04 21:30:53"
   requires="5.00"
   version="1.0"
   >

</plugin>


<!--  Triggers  -->

<triggers>
  <trigger
   enabled="n"
   keep_evaluating="n"
   name="invdata_start"
   script="invdata_start"
   match="{invdata}"
   send_to="10"
   sequence="100"
   omit_from_output="y"
  />
  <trigger
   enabled="n"
   keep_evaluating="n"
   group="invdata"
   match="^(?<objid>\d+),(?<flags>[^,]*),[^,]*,[^,]*,(?<type>\d+),.+$"
   script="invdata_line"
   send_to="10"
   sequence="100"
   regexp="y"
   omit_from_output="y"
  />
  <trigger
   enabled="n"
   keep_evaluating="n"
   group="invdata"
   match="{/invdata}"
   script="invdata_end"
   send_to="10"
   sequence="100"
   omit_from_output="y"
  />
</triggers>

<aliases>
  <alias
   match="^put? (?:kept|keep) +(?<target>.+)$"
   script="put_kept"
   regexp="y"
   enabled="y"
   sequence="100"
  />
</aliases>

<script>
<![CDATA[

  local container
  local items_found

  function put_kept(name, line, wildcards)
    container = wildcards.target
    EnableTrigger("invdata_start", true)
    SendNoEcho("invdata")
  end

  function invdata_start()
    EnableTrigger("invdata_start", false)
    EnableTriggerGroup("invdata", true)
    items_found = false
  end

  function invdata_line(name, line, wildcards)
    -- skip non-kept items
    if not string.find(wildcards.flags, "K") then
      return
    end
    -- skip containers
    if wildcards.type == "11" then
      return
    end

    items_found = true
    SendNoEcho(string.format("put %s %s", wildcards.objid, container))
  end

  function invdata_end()
    EnableTriggerGroup("invdata", false)
    if not items_found then
      Note("No kept items found.")
    end
  end

]]>
</script>

</muclient>
